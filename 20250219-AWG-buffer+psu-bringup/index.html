<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="The PCB ![[Pasted image 20250221200047.png]]
Basically the same as the [[20250103 awg buffer bringup|previous]] one, but with the changes integrated and the addition of the positive and negative rails for the op amp."><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.b3259f812ed133e49589f69cf23d7208.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.26876d25309ac50fcf840301327a04f4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20250219%20AWG%20buffer+psu%20bringup.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#voltage-level>Voltage level</a></li><li><a href=#power-rail-flip>Power rail flip</a></li><li><a href=#bias-resistors>Bias resistors.</a></li></ol></li><li><a href=#weird-startup-behavior>Weird startup behavior</a></li></ol><ol><li><ol><li><a href=#ferrite-beads>Ferrite beads</a></li></ol></li><li><a href=#no-input-required>No input required.</a><ol><li><a href=#power-supply-aside>Power supply aside</a></li></ol></li><li><a href=#most-things-are-obvious-once-explained>Most things are obvious, once explained</a></li><li><a href=#10r-loading-fail-to-start-supplies>10R loading fail to start supplies</a></li><li><a href=#external-mosfet>External MOSFET</a><ol><li><a href=#art-of-electronics>Art of electronics</a></li></ol></li><li><a href=#left-turn>Left turn</a></li><li><a href=#current-limiting>Current limiting</a></li></ol></nav></details></aside><a href=#the-pcb><h1 id=the-pcb><span class=hanchor arialabel=Anchor># </span>The PCB</h1></a><p><img src="/quartz/Pasted image 20250221200047.png" width=auto></p><p>Basically the same as the <a href=/quartz/20250103-awg-buffer-bringup rel=noopener class=internal-link data-src=/quartz/20250103-awg-buffer-bringup>previous</a> one, but with the changes integrated and the addition of the positive and negative rails for the op amp. The rails look like this:</p><p><img src="/quartz/Pasted image 20250219210052.png" width=auto>
<img src="/quartz/Pasted image 20250219210101.png" width=auto></p><p>I asked claude to generate all the component values for this based on the datasheet and didn&rsquo;t bother to check them much. As a result:</p><a href=#changes-required><h1 id=changes-required><span class=hanchor arialabel=Anchor># </span>Changes required</h1></a><a href=#voltage-level><h3 id=voltage-level><span class=hanchor arialabel=Anchor># </span>Voltage level</h3></a><p>Need to change &ldquo;R2&rdquo; to 11k for both power supplies since the formula for the output voltage is:</p><p><img src="/quartz/Pasted image 20250219210159.png" width=auto></p><p>Vth == 1.25V.</p><a href=#power-rail-flip><h3 id=power-rail-flip><span class=hanchor arialabel=Anchor># </span>Power rail flip</h3></a><p>I got the inverting and noninverting inputs wrong for the amp before, so I selected the amp in kicad and pressed &lsquo;y&rsquo; to flip it in the y axis:</p><p><img src="/quartz/Pasted image 20250220075355.png" width=auto></p><p>&mldr;yeah, that was a mistake.</p><a href=#bias-resistors><h3 id=bias-resistors><span class=hanchor arialabel=Anchor># </span>Bias resistors.</h3></a><p>For some reason the bias resistors:</p><p><img src="/quartz/Pasted image 20250220075532.png" width=auto></p><p>were specified to be 330R each, not 4k. Thermal camera saved me on that one I think.</p><a href=#weird-startup-behavior><h2 id=weird-startup-behavior><span class=hanchor arialabel=Anchor># </span>Weird startup behavior</h2></a><p>About 80% of the time the negative rail comes up fine. 20% of the time it hits my power supply current limit of ~600mA at a 1.9V input voltage. The switch node looks like this at this time:</p><p><img src="/quartz/Pasted image 20250220190836.png" width=auto></p><p>Don&rsquo;t know why this is, but it&rsquo;s clearly just shorting the inductor to ground permanently. I noticed that the example schematic had 470uF on the output instead of my 60uF so I added a 470uF electrolytic too. That seems to have fixed the problem. I assume that if there isn&rsquo;t enough capacitance in the system the inductor will discharge itself in less than one switching cycle or something like that and get the chip into a bad state.</p><p>&mldr;Actually this did not fix the issue. There are some super weird correlations going on. It&rsquo;s almost as though the temperature is important, it seems more likely to happen right after soldering something on. But it also might just be that it happens more often after waiting a while. There definitely don&rsquo;t seem to be any caps that take a while to discharge, so it isn&rsquo;t that.</p><p>I thought that perhaps there wasn&rsquo;t enough input capacitance, and so the voltage on the input was going really low on the first switch of the power supply, and the subsequent switch never turned off and shorted the inductor to ground. It isn&rsquo;t that either, I can see on occasions where it &lsquo;works&rsquo; the power rail goes up to 2V, and on occasions where it doesn&rsquo;t work it just goes up to 10, monotonically in both cases.</p><p>This is what a successful startup looks like:</p><p><img src="/quartz/Pasted image 20250221075302.png" width=auto></p><p>and an unsuccessful one (had to zoom in a lot):
<img src="/quartz/Pasted image 20250221075620.png" width=auto></p><p>I also tried adding a 10uF cap to ground on the feedback pin for a &ldquo;soft start&rdquo; per ChatGPT, but that did not work. What actually is the problem is that this particular power supply turns on too slowly. I&rsquo;ve been turning my pcb off and on using the main switch on the power supply, and that gives a ramp rate of what you see in the first picture above. If instead I just jam the SMA connector into the power supply after it is turned on then the rise time is much shorter and everything works fine. I guess if the output switch turns on at a voltage lower than what&rsquo;s required to hit the &lsquo;off&rsquo; condition then it really is just a short to ground.</p><p>Now after hot gluing on my own switch things are 100% reliable. When it is in actual use powered by a USB or something else, it will have the full rail voltage available straightaway.</p><a href=#oscillation><h1 id=oscillation><span class=hanchor arialabel=Anchor># </span>Oscillation</h1></a><p>This is what the output looks like with a ramp fed in and the power supplies working:</p><p><img src="/quartz/Pasted image 20250221202657.png" width=auto></p><p>Per Jim Williams AN47 in the <a href=/quartz/20250103-awg-buffer-bringup#bandwidth-of-op-amp rel=noopener class=internal-link data-src=/quartz/20250103-awg-buffer-bringup>previous bringup</a>, this is very likely the larger power transistors being slower somehow, despite the fact that they worked fine when I deadbugged them on the previous rev of the board. There is no oscillation present when the output is 50R terminated though, I wonder why that is. Time to measure the rise time. Here is the change I made, so the op amp excludes the booster circuit from the feedback loop:</p><p><img src="/quartz/Pasted image 20250221205958.png" width=auto></p><p>(actually just moving R120 into the C102 footprint). Interestingly the oscillation is still present! It goes away if R114 is removed. It also takes a second or so to come back after power on, which is interesting. The frequency is around 50MHz.</p><a href=#ferrite-beads><h3 id=ferrite-beads><span class=hanchor arialabel=Anchor># </span>Ferrite beads</h3></a><p>Let&rsquo;s see if replacing R111 and R108 with ferrite beads per the app note:</p><p><img src="/quartz/Pasted image 20250221210122.png" width=auto></p><p>works.</p><p>using a 600R@100MHz ferrite in an 0603 package I get this:</p><p><img src="/quartz/Pasted image 20250221210840.png" width=auto></p><p>&mldr;Rather the wrong direction, that. Shorting out the ferrite entirely actually makes it a fair bit better. I also noticed that the oscillation is extremely temperature dependent. A whiff of condensed air spray makes it huge, and a whiff from the hot air gun makes it go away. ChatGPT informs me that the gain of a bipolar transistor goes up as a function of temperature, so that might be it.</p><p>From poking with the soldering iron and the condensed air can, it is clear that Q103 and Q107 are indeed responsible for the temperature dependence of the oscillation.</p><p>Since the DC resistance of the ferrite bead is ~0, and I replaced a 10R resistor with it, I thought maybe the worsening of the oscillation came from the drop in DC resistance and not from the ferrite beads ferritey properties. So I put a 10R resistor back in, this time in series with a 60R@100Mhz ferrite (instead of 600R@100MHz) so as to have a lower Q. This makes the oscillations quite a lot worse than with the 10R resistor, which doesn&rsquo;t make much sense to me.</p><a href=#no-input-required><h2 id=no-input-required><span class=hanchor arialabel=Anchor># </span>No input required.</h2></a><p>Now, the booster stage seems to be quite happy to oscillate (with a many volt amplitude) when it&rsquo;s all by itself. The only requirement is that a 1m coax cable is attached to the input (so 100pF ish), and the cable on the input is not terminated. When that is the case, it will oscillate even if the output is loaded with 50R.</p><p>I decided at this point to simulate things. Since my windows VM has also kicked the bucket I went and installed wine to run LT spice. I am not able to get the simulation to oscillate, surprise surprise. Tried adding various capacitances to the input and output, to no avail:</p><p><img src="/quartz/Pasted image 20250222201557.png" width=auto></p><p><img src="/quartz/Pasted image 20250222201616.png" width=auto></p><a href=#power-supply-aside><h3 id=power-supply-aside><span class=hanchor arialabel=Anchor># </span>Power supply aside</h3></a><p>I disconnected the base resistors R108 and R111. when either of them is disconnected, the power supply reliably exhibits the &ldquo;<a href=/quartz/20250219-AWG-buffer+psu-bringup#weird-startup-behavior rel=noopener class=internal-link data-src=/quartz/20250219-AWG-buffer+psu-bringup>shorted powerup</a>&rdquo; issue of before, even when the rise time of the input is as fast as my mechanical switch can go:</p><p><img src="/quartz/Pasted image 20250222202100.png" width=auto></p><a href=#most-things-are-obvious-once-explained><h2 id=most-things-are-obvious-once-explained><span class=hanchor arialabel=Anchor># </span>Most things are obvious, once explained</h2></a><p>The circuit oscillates. So, it must have a feedback loop some where. Where is there a loop on the schematic?</p><p><img src="/quartz/Pasted image 20250222202754.png" width=auto></p><p>Duh. Removing Q106 and Q108 stop the oscillation in its tracks. And I just realised <a href=/quartz/20250219-AWG-buffer+psu-bringup#no-input-required rel=noopener class=internal-link data-src=/quartz/20250219-AWG-buffer+psu-bringup>above</a> that I didn&rsquo;t even put those diodes in the simulation (because it was a sim of rev1 of the board). Unfortunately, adding them in properly does not reproduce the oscillation either, so I will have to debug in the real world as per usual. First step is adding a hefty resistor from the output side of the diodes to the actual output. That way I can keep R114, R108, R111 a ~0R, whilst still adding a lot of damping in the feedback loop. I wonder if my choice of a diode-connected-transistor here rather than an actual diode is what is enabling the oscillation somehow, but don&rsquo;t see why.</p><p>Anyhow, this change fixes the oscillations completely:</p><p><img src="/quartz/Pasted image 20250222203829.png" width=auto></p><p>The difference in performance of the fall time over temperature:</p><p><img src="/quartz/Pasted image 20250222204055.png" width=auto></p><a href=#10r-loading-fail-to-start-supplies><h2 id=10r-loading-fail-to-start-supplies><span class=hanchor arialabel=Anchor># </span>10R loading fail to start supplies</h2></a><p>Since the amplifier works properly now apparently, time to test it under load. Adding a 10R power resistor to ground makes the amplifier fail to start up though. However, starting the system and then attaching the load yields this result, alongside a 130 degree negative rail chip:</p><p><img src="/quartz/Pasted image 20250222210114.png" width=auto></p><p>Where the top and bottom trace are the positive and negative rails, which should of course be at 15V. At this time the current sense resistors on the booster stage look like they have around 300mV across them, but not enough to turn on the current limiting funcitonality.</p><p>Here is the AC coupled voltage on the low side of the negative voltage rail:</p><p><img src="/quartz/Pasted image 20250222211928.png" width=auto></p><p><img src="/quartz/Pasted image 20250222212010.png" width=auto></p><p>So it looks like the current limit is kicking in here on the negative rail. Probably the positive one too.</p><p><img src="/quartz/Pasted image 20250222212303.png" width=auto></p><p>However, the negative rail IC is currently sitting at 117deg. The perfect temperature, I wouldn&rsquo;t dare put it any hotter. The inductor is also cooking at a decent temperature too!</p><p>The power output of the IC is defined by the &ldquo;switch current&rdquo;. I take this to be the definition of the switch current:</p><p><img src="/quartz/Pasted image 20250222212619.png" width=auto></p><p>because it makes sense, and because the datasheet says the switch current is measured by the current sense resistors. However the total switch current for both amplifiers combined is 1A as measured by my bench supply. So I don&rsquo;t see how I can be exceeding that here. Here is the table of the efficiency for the inverting configuration in the datasheet:</p><p><img src="/quartz/Pasted image 20250222212929.png" width=auto></p><p>???? It&rsquo;s only 50%??? What? All the other configurations are like 85%, so I just assumed that the inverting would be the same!</p><a href=#external-mosfet><h2 id=external-mosfet><span class=hanchor arialabel=Anchor># </span>External MOSFET</h2></a><p>Perhaps I can increase the efficiency, or at least move the heat out of this poorly heatsunk SOIC-8 package by adding an external transistor. The datasheet does not have information on how to do this for the inverting converter, so I did this:</p><p><img src="/quartz/Pasted image 20250223181736.png" width=auto></p><p>This does not work and had me puzzled for quite some time. With no load connected the output only gets to -8V. However it transpires that this is for headroom reasons. The input is only 5V. The top of the inductor can only be driven to (5V - switch voltage drop - MOSFET threshold voltage) which is like 2.5V. And the MOSFET isn&rsquo;t even hard on, because the source of the MOSFET wants to float up to the supply.</p><p>Increasing the supply voltage to 10V means that the regular can achieve its desired output voltage of -15V. But attaching a load brings that downs to -10V and also puts the MOSFET at around 140C, most likely because the source will always float up to where the gate is. I wonder if I powered the NCP3063 off the 15V rail, and put the MOSFET drain at 5V. Then, the source would float all the way up to the 5V supply rail since the gate would be at 15V.
That&rsquo;s worth an experiment.</p><p>I performed this experiment by changing the input voltage to 10V, and then powering the drain of the external FET from a 5V supply. This succeeded in regulating to 15V fine, since when the supply switch is conducting, the gate is driven to +10V, with the source sitting at the input voltage of +5V. When the switch is no longer conducting, a 100R resistor pulls it down to the negative rail of -15V, so the gate is turned off properly.</p><p>With no load, the max temperature of any component is 47 degrees. With a 10R load on the output, the op amp can&rsquo;t swing past about +/-5V or so, and the inductor gets up to 160 degrees. Toasty! The waveforms on the gate (yellow) and the source of the FET (green) look like this:</p><p><img src="/quartz/Pasted image 20250223202047.png" width=auto></p><p>This isn&rsquo;t exactly textbook, but also I don&rsquo;t see what could be done to improve things here. The inductor I am using is this one:</p><p><img src="/quartz/Pasted image 20250223202829.png" width=auto></p><p>I&rsquo;m drawing an average of like 1.5A here, so that isn&rsquo;t great. I need to figure out if the inductor is doing the right thing here.</p><a href=#art-of-electronics><h3 id=art-of-electronics><span class=hanchor arialabel=Anchor># </span>Art of electronics</h3></a><p>The art of electronics (still better than an LLM!) has this to say on the topic:</p><p><img src="/quartz/Pasted image 20250223203525.png" width=auto></p><p>So it looks like I want to measure the current going through the inductor somehow, and see if it has a sawtooth. Deviations from that presumably mean something bad.</p><p>The art of electronics says that the minimum inductance is:</p><p>$$
L_{\text{min}} = \frac{T}{2} \frac{V_{\text{out}}}{I_{\text{out}}} \left( \frac{V_{\text{in}}}{V_{\text{in}} + |V_{\text{out}}|} \right)^2
$$
Where T = switching period.</p><p>Which in my case given a 60us switching period is <code>(60e-6/2)*(15/0.5)* (5/(5+15))**2</code> = 56uH. My inductor is 226uH which might be a bit high I suppose, but not unreasonable.</p><p>I connected a stainless steel strip between the source of the FET and the switch node. It&rsquo;s around 0.1R I think but I&rsquo;ll measure it later if it&rsquo;s important. Channel 2 and 4 measured either and, and math was used to subtract.</p><p>Here is the current going through with the supply powering the circuitry, but only a 50R load on the output:</p><p><img src="/quartz/Pasted image 20250223214514.png" width=auto></p><p>And with the supplies disconnected from the booster circuit, so the load is 0:</p><p><img src="/quartz/Pasted image 20250223214717.png" width=auto></p><p>Well then. It looks like what I&rsquo;m measuring is the difference in gain between the two channels. This is what the current looks like when I measure using a sense resistor attached to the <em>bottom</em> of the inductor:</p><p><img src="/quartz/Pasted image 20250227072230.png" width=auto></p><p>Looks like the supply is only switching once in a while. This is what it looks like with the booster circuit hooked up with a 50R load:</p><p><img src="/quartz/Pasted image 20250227073439.png" width=auto></p><p>Actually all of the above was done without the waveform generator putting in its customary ramp wave. When that&rsquo;d done things looks different:</p><p><img src="/quartz/Pasted image 20250227074040.png" width=auto></p><p>Can&rsquo;t really say that anything jumps out as bad here, really.</p><p>$$
I_{\text{out(min)}} = \frac{T}{2L} V_{\text{out}} \left( \frac{V_{\text{in}}}{V_{\text{in}} + |V_{\text{out}}|} \right)^2
$$
This is the equation for the minimum amount of current from <a href=/quartz#art-of-electronics rel=noopener class=internal-link data-src=/quartz>above</a>. The minimum current is not a function of the load, apparently. That seems kind of sus. But the equation for the peak current does have the average load in it, so that makes sense.</p><p>In this experiment by the way the supply can only keep working for 10s or so before something heats up enough and the 2A supply limit on my bench supply is reached so the supply voltage collapses.</p><p>Anyway clearly the minimum current in the inductor is a huge function of the load on the system since it&rsquo;s so high when the output ramp is negative.</p><a href=#left-turn><h2 id=left-turn><span class=hanchor arialabel=Anchor># </span>Left turn</h2></a><p>I&rsquo;m giving up on this. Too much effort. I found the
<a href=https://www.lcsc.com/datasheet/lcsc_datasheet_2411041759_XLSEMI-XL6007E1_C73334.pdf rel=noopener>XL6007</a> on aliexpress, it seems to be a good chip. There are +/-15V modules available on aliexpress for
<a href="https://www.aliexpress.us/item/3256805735027895.html?spm=a2g0o.productlist.main.17.7e895b50zBrsam&algo_pvid=543b38d7-873a-4956-a308-9a7b45472a0f&algo_exp_id=543b38d7-873a-4956-a308-9a7b45472a0f-8&pdp_ext_f=%7B%22order%22%3A%2211%22%2C%22eval%22%3A%221%22%7D&pdp_npi=4%40dis%21USD%214.88%213.42%21%21%214.88%213.42%21%40%2112000036837542484%21sea%21US%21783315244%21X&curPageLogUid=lRBnbCBktkdQ&utparam-url=scene%3Asearch%7Cquery_from%3A" rel=noopener>$3.40</a>, so I will buy the module and either plop it in or copy-paste it into my design. Interestingly this represents the first time that I have found a chinese IC that will do my job and no western ones. Also interestingly the datasheet suggests using a transformer for the dual output:</p><p><img src="/quartz/Pasted image 20250227204810.png" width=auto></p><p>But the aliexpress picture just shows a bunch of regular inductors:</p><p><img src="/quartz/Pasted image 20250227204931.png" width=auto></p><p>So I am interested to see how it works. For now I&rsquo;ll hook up the bench supplies and continue load testing.</p><a href=#current-limiting><h2 id=current-limiting><span class=hanchor arialabel=Anchor># </span>Current limiting</h2></a><p>During the course of my load testing I decided to solder a 10R resistor to ground on the output of the AWG. I did this when it was switched on, thinking that the current limiting circuit would work. Reader, it did not. After replacing the op-amp and a bunch of the transistors, I got it back up and running. Then I decided to monitor the current going through the sense resistor, like so:</p><p><img src="/quartz/Pasted image 20250228204428.png" width=auto></p><p>Interestingly, it seems the capacitance of the cable is enough to set up some oscillation:</p><p><img src="/quartz/Pasted image 20250228204521.png" width=auto></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20250219 AWG buffer+psu bringup.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/20250219-AWG-buffer+psu-bringup/ data-ctx=above data-src=/20250219-AWG-buffer+psu-bringup class=internal-link></a></li><li><a href=/quartz/20250322-AWG-power-supply-cop-out/ data-ctx="stop the oscillation" data-src=/20250322-AWG-power-supply-cop-out class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2025</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>