<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="XOR gate as phase detector Maybe the problem is with the mixer, not any phase response stuff in the loop filter."><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.8f4230455efd5f804007402cc7721364.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.0170edfd5adb5c5202854bfdb8fc31ab.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20220617%20XOR.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><ol><li><a href=#bad-tuning-range>Bad tuning range</a></li><li><a href=#fiddling-with-locking>Fiddling with locking</a></li></ol></li><li><a href=#better-isolation>Better isolation</a></li><li><a href=#wheres-that-field>Where&rsquo;s that field?</a></li></ol></nav></details></aside><a href=#xor-gate-as-phase-detector><h1 id=xor-gate-as-phase-detector><span class=hanchor arialabel=Anchor># </span>XOR gate as phase detector</h1></a><p>Maybe the problem is with the mixer, not any phase response stuff in the loop filter.
I have wired up the SN74AHC1G86 as a phase detector.
Initially I was worried about getting enough swing on the output of the VCO&rsquo;s to properly hit the logic levels but this turn out not to be strictly necesary, if you AC couple things into a vcc/2 voltage divider on the inputs then a few hundred mV is enough.
I did need to turn down the power rail to 5V from 7V for compatibility, but I was gonna do that anyway.
Here is what it look like with one input being a VCO output and the other coming from the AWG on the scope:</p><p><img src="/quartz/Pasted image 20220617115345.png" width=auto></p><p>CH1: output of VCO
CH2: output of AWG
CH3: output of XOR
Looks great!
The interference from the rising/falling edgess on CH1 seems to be mostly probing related (it&rsquo;s on a 100:1+ divider so as to not interfere with the actual circuit too much)
Now to lowpass it. I hope that there aren&rsquo;t too many problems here as the nominal &lsquo;zero phase&rsquo; is at vcc/2.
Taking the loop filter from here: <a href=/quartz/20220301-fm-Loop-the-loop#designing-a-loop-filter rel=noopener class=internal-link data-src=/quartz/20220301-fm-Loop-the-loop>20220301 fm - Loop the loop</a> once again and making sure to terminate the output of the filter at 50R, we get this:</p><p><img src="/quartz/Pasted image 20220617144220.png" width=auto></p><p>Noice.
Only problem is the measurement of the two input frequencies is super corrupted from the xor edges. I probed the actual inputs though and again this seems to be a probing artefact.</p><a href=#bad-tuning-range><h3 id=bad-tuning-range><span class=hanchor arialabel=Anchor># </span>Bad tuning range</h3></a><p>Perhaps as a result of reducing the supply voltage to 5V I notice that one of the VCO&rsquo;s does not want to tune above about 10.5MHz without the amplitude dropping off a whole bunch. Perhaps adding more to C2 to increase the amount of feedback?</p><p><img src="/quartz/Pasted image 20220618134226.png" width=auto></p><p>&mldr;Adding 100pF to C2 stops the oscillation entirely.</p><p>scratchpad:
R13 to 300R. increased DC point, did not increase modulation amplitude
C4 to 100pF. This increased the modulation to 1.5V
I notice that probing the output increases the modulation amplitude slightly. Perhaps that means that I&rsquo;ve gone too far, and C4 should be increased a bit? It did not. 1.4->1.13vpp.
C4 back to 100pF, increasing C2 by 47pF stops modulation entirely.
Note: impedance of 100pF is 159R at 10MHz. that actually sounds a bit low, so maybe a very small C4 is what&rsquo;s required.
CHange C4 to 20 or 50 pF results in no oscillation.</p><a href=#fiddling-with-locking><h3 id=fiddling-with-locking><span class=hanchor arialabel=Anchor># </span>Fiddling with locking</h3></a><p>Perhaps one of the reasons that the thing doesn&rsquo;t lock is that the control output is in the wrong wrange (maybe it&rsquo;s 3-4v output but 2v is needed). Changing R35</p><p><img src="/quartz/Pasted image 20220618170951.png" width=auto></p><p>to a potentiometer allows the DC point of the output to be adjusted. Swinging over the full range does not result in a lock, but it does result in two interestingly distinct phase oscillations:</p><p><img src="/quartz/Pasted image 20220618171224.png" width=auto></p><p>and</p><p><img src="/quartz/Pasted image 20220618171125.png" width=auto></p><p>as a result of wiggling the output up and down.
To me this kind of looks like the feedback is the wrong way round and the two modes above are the input signal being above and below the VCO.
Taking the opposite sign outputut from the diff amp (R26 instead of R25) we get:</p><p><img src="/quartz/Pasted image 20220618180819.png" width=auto></p><p>&mldr;A locked PLL! ta-dah!
I had assumed previously that it did not matter if positive or negative feedback was taken from the output of the diff amp, as that would jusst change whether the loop locked on the rising or falling edge of the phase detector output. This isn&rsquo;t a conclusive investigation but it seems I was wrong about that.
The lock ranges from the state:</p><ul><li>900mV, 10.05MHz(ish)</li></ul><p>When the pot that gives the VCO a sensible voltage while the loop is disconnected is itself disconnected, the PLL fails to lock at any frequency and looks like this:</p><p><img src="/quartz/Pasted image 20220618180530.png" width=auto></p><p>The persistence view of the scope suggests there is some locking adjacent behaviour going on here.</p><a href=#better-isolation><h2 id=better-isolation><span class=hanchor arialabel=Anchor># </span>Better isolation</h2></a><p>Overall though even though the lock is quite stable itcan still be disrupted with the aerial screwdriver technique. I had removed the buffers on the output o f the oscillators so maybe putting those back in will help.
The BCX70K doesn&rsquo;t really have any appreciable gain at 10MHz apparently, so I have switched to the BFR106 which according to LT spice will do just fine.
The following circuit also does quite well in practice:</p><p><img src="/quartz/Pasted image 20220619175006.png" width=auto></p><p><img src="/quartz/Pasted image 20220619175100.png" width=auto></p><p>(green is the output.)</p><p>I did this on both oscillators and although there are now nice large distorted square waves going into the XOR gate, the circuit still has the same screwdriver susceptibility. You can even turn the lock on and off with the right gesture.
The circuit also has quite a bit of screwdriver velocity sensitivity also.
Current state of the circuit btw:</p><p><img src="/quartz/Pasted image 20220619181407.png" width=auto></p><a href=#wheres-that-field><h2 id=wheres-that-field><span class=hanchor arialabel=Anchor># </span>Where&rsquo;s that field?</h2></a><p>Being quite a lot longer than the circuit itself, the screwdriver is a rather nonspecific way of finding the location of this external interference susceptibility. A small magnet does quite a lot better. Couple of observations:</p><ul><li>The circuit seems to be most sensitive around the actual VCO. When the magnet is moved over that bit (irrespective of the magnets orientation) then the PLL losess the lock.</li><li>the big inductor changes its inductance a <em>lot</em> in the presence of the magnetic field! the frequency goes from 10->14MHz!</li><li>Hot gluing a ~2mm chip of neodymium magnet on the end of a platic spatula reveals that it is definitely the inductor and only the inductor that is susceptible to external interference. The two circuits have two different sized 10uH inductors on them and the smaller one is much more susceptible. Perhaps this is why shielded inductors are a thing&mldr;</li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20220617 XOR.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/20220701-Inductance-measurements/ data-ctx="20220617 XOR#Where's that field" data-src=/20220701-Inductance-measurements class=internal-link></a></li><li><a href=/quartz/index_base/ data-ctx="20220617 XOR.md" data-src=/index_base class=internal-link>Harry dB notes</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2024</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>