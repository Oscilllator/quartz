<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Board Populated most of the things:
![[Pasted image 20220428184452.png]]
Might be a bit inconvenient to probe. Output does not oscillate, of course."><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.71326bb7c30be3e7e7118b160d604197.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.1c1c14f6332b66da68778557b73424b1.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20220428%20FM%20v2%20bringup.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#debugging>Debugging</a><ol><li><a href=#initial-observations>Initial observations</a></li></ol></li><li><a href=#whats-that-capacitor>What&rsquo;s that capacitor:</a></li><li><a href=#first-mixing>First mixing</a></li><li><a href=#measurements-of-inductor>Measurements of inductor</a></li><li><a href=#things-stop-working>Things stop working</a><ol><li><a href=#response-time-of-vco>Response time of VCO:</a></li><li><a href=#slowing-things-down-dumb-version>Slowing things down (dumb version)</a></li><li><a href=#bandwidth-of-loop-filter>Bandwidth of loop filter</a></li></ol></li><li><a href=#quick-note-phantom-lock>Quick note: phantom lock</a><ol><li></li><li><a href=#quick-note-phase-shift>Quick note: phase shift</a></li><li><a href=#results>Results</a></li></ol></li></ol></nav></details></aside><a href=#board><h1 id=board><span class=hanchor arialabel=Anchor># </span>Board</h1></a><p>Populated most of the things:</p><p><img src="/quartz/Pasted image 20220428184452.png" width=auto></p><p>Might be a bit inconvenient to probe.
Output does not oscillate, of course.</p><a href=#debugging><h2 id=debugging><span class=hanchor arialabel=Anchor># </span>Debugging</h2></a><p>Relevant section of the schematic:</p><p><img src="/quartz/Pasted image 20220428184557.png" width=auto></p><p>First things first: check the bias on the transistor.
I think R13 is way too low by the way. after desoldering the working oscillator it&rsquo;s 131R</p><a href=#initial-observations><h3 id=initial-observations><span class=hanchor arialabel=Anchor># </span>Initial observations</h3></a><p>Q1 Vg = 1.131, Vs=1.396 => Vgs = -0.265
So according to datasheet:</p><p><img src="/quartz/Pasted image 20220428185644.png" width=auto></p><p>The current should be around 25mA. R3 is 100R and I measured 1.382V => 13mA. Seems quite low!
The quiescent current of the JFET seems roughly similar to the working set so I think it&rsquo;s most likely the C4/C5 values that are off, and I don&rsquo;t know what the right ones are. Time to use the VNA!</p><a href=#whats-that-capacitor><h2 id=whats-that-capacitor><span class=hanchor arialabel=Anchor># </span>What&rsquo;s that capacitor:</h2></a><p>Test setup 1: using the above PCB to easily connect components to the VNA over a UFL connector:</p><p><img src="/quartz/Pasted image 20220501141447.png" width=auto></p><ul><li>56pF is measured at about 61pF</li><li>The cable by itself (even after calibrating) seems to be about 3.4pF. Maybe I need to have a more stable test setup.</li><li>9.1pF is measured ass 13.6pF. subtracting, that&rsquo;s 10.4pF. Aliexpress &ldquo;tolerance&rdquo; is 5% so that may well be right</li><li>C2 on the above schematic was measured at 105pF</li><li>Adding some flux changed the open circuit capacitance to 3.7pF</li><li>C4 on the above schematic (soldered as two in ||) was 325pF
Now to resolder the above values to the new pcb!
This gets the oscillator running just fine.
Note: decreasing R13 to 65R stops the oscillation.</li></ul><a href=#first-mixing><h2 id=first-mixing><span class=hanchor arialabel=Anchor># </span>First mixing</h2></a><p>Here is an image of the phase output, and then the output of the diff amp that amplifies that phase:</p><p><img src="/quartz/Pasted image 20220501213136.png" width=auto></p><p><img src="/quartz/Pasted image 20220501213302.png" width=auto></p><p>All of this is looking pretty spiffy so far.</p><a href=#measurements-of-inductor><h2 id=measurements-of-inductor><span class=hanchor arialabel=Anchor># </span>Measurements of inductor</h2></a><p>The big coil inductor works but the small 0603 inductor does not. Why?</p><p>I <em>think</em> that this measures the inductance:</p><p><img src="/quartz/Pasted image 20220507133257.png" width=auto></p><p>Incomprehensible chart:</p><p><img src="/quartz/Pasted image 20220507133317.png" width=auto></p><p>It&rsquo;s unsurprising that the small inductor works better at higher frequencies, but it&rsquo;s a bit surpriing that it works that well. Both inductors measure about 10uH at 50kHz.
Here&rsquo;s what it looks like at 50kHz-900MHz:
<img src="/quartz/Pasted image 20220507134632.png" width=auto></p><pre><code>Allegedly the small inductor (L0603B100KDWFT) is also wire wound so I would have thought it would have the same overall shape as the larger inductor. 
</code></pre><a href=#things-stop-working><h2 id=things-stop-working><span class=hanchor arialabel=Anchor># </span>Things stop working</h2></a><p>The first new asembled board stopped working for some reason. 2.124V across the drain resistor of 100R => 21mA VDSS. Datasheet says it should be 35mA but there are some resistors in the way. The transitor on the working one is 2.181V, so clearly transistor isn&rsquo;t busted. Things started working again. I think it&rsquo;s cause if the VCO is not at a defined voltage then things get wack.</p><a href=#response-time-of-vco><h3 id=response-time-of-vco><span class=hanchor arialabel=Anchor># </span>Response time of VCO:</h3></a><p>^eed27d</p><p>Max F dev: 6.05e5. Min: 2.8e4. => 90% = 5.47e5. 10% = 8.5e4
t_90: 1.493ms, t_10 = 1.544ms. => Bandwidth = 0.35/(1.544e-3 - 1.493e-3) = 6.8KHz. This would seem rather too low. That&rsquo;s with a 50k. Resistor. Should go back to 10.7kOhm
10.7kOhm leads to 68kHz bandwidth:</p><p><img src="/quartz/Pasted image 20220508104443.png" width=auto></p><a href=#slowing-things-down-dumb-version><h3 id=slowing-things-down-dumb-version><span class=hanchor arialabel=Anchor># </span>Slowing things down (dumb version)</h3></a><p>As per before we now need to slow down the response of the loop filter to be slower than that of the VCO. I did this like so:</p><p><img src="/quartz/Pasted image 20220508133147.png" width=auto></p><p>So that should be 30kHz bandwidth.</p><a href=#bandwidth-of-loop-filter><h3 id=bandwidth-of-loop-filter><span class=hanchor arialabel=Anchor># </span>Bandwidth of loop filter</h3></a><p>Here is the bandwidth of the loop filter after adding the 30kHz mod:</p><p><img src="/quartz/Pasted image 20220510211453.png" width=auto></p><p>Hit the nail on the head there. You can also see that the diff amp has oodles of gain.
But wait!
This is the bandwidth of just the passive component of the loop filter</p><p><img src="/quartz/Pasted image 20220510195950.png" width=auto></p><p>That&rsquo;s a bit surprising. This completely passive filter has a gain of 13dB? Time to collect my nobel prize for violating thermodynamics.</p><p><img src="/quartz/Pasted image 20220510200352.png" width=auto></p><p>&mldr;Yep. Now that&rsquo;s what I call resonance! Take note of the y scale.</p><p>This is the diff amp by itself:</p><p><img src="/quartz/Pasted image 20220510201412.png" width=auto></p><p>&mldr;I feel like it should have more bandwidth than this. LT spice agrees and says it should be 1MHz. Probing around does not reveal anything noteworthy. It might be worth doing a common emitter amplifier configuration just to check against the spice model.</p><p>Although the &ldquo;3dB&rdquo; point of this system is 30Khz, it still has 20+dB of gain at 60kHz. So to get &#171;0dB of gain at 60khz I think moving the elliptical loop filter to a much lower bandwidth is in order.
The filter tool says this:</p><p><img src="/quartz/Pasted image 20220510211848.png" width=auto></p><p><img src="/quartz/Pasted image 20220510211857.png" width=auto></p><p>(adjusted the impedance to get 1mH inductor value.)
That did not seem to be good enough. This works better:</p><p><img src="/quartz/Pasted image 20220512185819.png" width=auto></p><p><img src="/quartz/Pasted image 20220512185924.png" width=auto></p><p>Where C3 is the passive filter + diff amp and C1 is just the passive filter.
The output crosses 0dB gain at about 30kHz and is at ~-10dB at 60kHz so hopefully this will be good enough. If this doesn&rsquo;t work then reducing the rather large gain of the diff amp would be a good next step.</p><p>&mldr;This produces utter trash:</p><p><img src="/quartz/Pasted image 20220512202614.png" width=auto></p><p>In the above trace Channel 2 is the phase output as a result of sending in a 17mVpp ramp wave in. Changing the offset by 10mV is enough to render the signal borderline unusable and so I take it from that that the control output would also be like 10mV.
So I think increasing the bandwidth of the loop filter a whole bunch and going back to a lower gain amp is the way to go.</p><a href=#quick-note-phantom-lock><h2 id=quick-note-phantom-lock><span class=hanchor arialabel=Anchor># </span>Quick note: phantom lock</h2></a><p>We have a lock:</p><p><img src="/quartz/Pasted image 20220515210602.png" width=auto></p><p>Situation: control loop switch is <em>open</em>.
Channel 1 and two are the RF and LO signal respectively. CH3 is the VCO voltage, about 7.5V. CH4 is VCC (7.97V)
V_lo = 1.395V, V_
The circuit is like this:</p><p><img src="/quartz/Pasted image 20220515210934.png" width=auto></p><p>It&rsquo;s clearly coupling in through the air somehow, waving a screwdriver around nearby can make it lose the lock. I think the key takeaway here is that the required voltage to lock (7.5Vish) is <em>way</em> higher than makes sense at first glance, it should be like 2V. I suppose given the fact that the control loop is open the actual DC voltage is not important, it&rsquo;s how it affects whatever dynamic nonsense is being used to close the loop through the aether.</p><h4 id=heading></h4><ul><li>Disconnecting the output of the diff amp completely still allows the PLL to lock.</li><li>After doing the above the switch (that is connected to the varactor diode but not the output of the diff amp) still prevents the circuit from locking when the switch is closed. This is weak evidence for that long trace running across the board acting as an antenna.</li><li>Desoldering the resistor that attaches to the VCO has no effect, it can still lock. I now presume that the locking is occuring through the mixer somehow. It only happens over a tiny (10&rsquo;s of mV MAX) voltage range as you would expect.</li></ul><a href=#quick-note-phase-shift><h3 id=quick-note-phase-shift><span class=hanchor arialabel=Anchor># </span>Quick note: phase shift</h3></a><p>Here is the output of the loop filter with a nice big capacitor and resitor for lowpassing. As you can see this has apalling phase performance. So I think going to the example filter in &ldquo;Introduction to radiofrequency design&rdquo; is a good idea as a sanity check.</p><p><img src="/quartz/Pasted image 20220516220123.png" width=auto></p><p>Note that the filter in the textbook is designed assuming a 1000x divider on the output of the VCO before it goes into the mixer.</p><p><img src="/quartz/Pasted image 20220516220240.png" width=auto></p><p>The circuit has been built:</p><p><img src="/quartz/Pasted image 20220528143515.png" width=auto></p><p>Note that a 10Meg resistor was added across the cap for the required DC path, and a 100R resistsor was added as an output load in an attempt to stabilise the DC output point of the amplifier, which varies by many V depending on cable positioning etc.</p><p><img src="/quartz/Pasted image 20220528143247.png" width=auto></p><p><img src="/quartz/Pasted image 20220528143200.png" width=auto></p><p>The red shaded area above is due to the 10 Meg resistor.
Here is the bode plot:</p><p><img src="/quartz/Pasted image 20220528143348.png" width=auto></p><p>Looks vaguely the same, exept that the phase shift component from the 10Meg resistor is missing. Suspicious&mldr;
I&rsquo;m also a bit worried that the phase shift goes up by a fair bit before the amplifier crosses zero gain.
The textbook says it should look like this (I think):</p><p><img src="/quartz/Pasted image 20220528143628.png" width=auto></p><p>The main troubling thing here is that the phase shift in the book is 180deg (negative feedback) but the sims and real life show 90 degrees. What gives?</p><a href=#results><h3 id=results><span class=hanchor arialabel=Anchor># </span>Results</h3></a><p>Needless to say, this does not work. It seems to get into the state where the F(VCO) > F(RF), and then you can adjust the RF frequency up and down with the VCO frequency sitting at some extra frequency above that, say +300kHz. I really think this must have something to do with the phase shift still for some reason. The whole point of this filter was that it was supposed to be out-of-the box working and given the phase shift is wildly different from what the author thinks it should be, it&rsquo;s time to move on I think.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20220428 FM v2 bringup.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/20220701-Inductance-measurements/ data-ctx="20220428 FM v2 bringup#^eed27d" data-src=/20220701-Inductance-measurements class=internal-link></a></li><li><a href=/quartz/index_base/ data-ctx="20220428 FM v2 bringup.md" data-src=/index_base class=internal-link>Harry dB notes</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2024</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>