I gave up on the fluid simulation on the basis that it wasn't going to go anywhere even if I could get it to work.
The next thing that I want to try is a baby version of alphafold. Instead of the input being the amino acid sequence and hte output being the positions of all of the atoms, the input will be a small molecule SMILES (atomic bonds) and the output will be the positions of the atoms.

# Dataset
It seems like the best dataset available for this is the Crystallography Open Database (COD). It has about 500e3 different molecules with their crystal structures determined via x ray diffraction or otherwise. The CIF files it contains have the positions of the atoms an a bunch of other metadata, but importantly they do _not_ have the actual bonds for the molecule in question. So if I want to calculate the 3d positions from the chemical bonds then that rather presents an issue.
There is an open source package openbabel that purports to do this and so I ran it against the whole dataset, which took about 10 hours. 
The dataset contains many things, not just single small molecules with simple bonds. There are ionic compounds, wack compounds, compounds with nobel gasses in them (??), all kinds of stuff. So some exploration and filtering is in order.

# Exploration
The quality of this dataset seems to be pretty weird. In addition to this the openbabel tool is _highly_ suspect in its smiles output. 

###  Case study: Urea
The chemical formula for [Urea](https://www.crystallography.net/cod/2003112.html) is `C H4 N2 O` and it looks like this:
![[Pasted image 20230717073831.png]]
Yet apparently the smiles string for it is `O=[C]N` which is clearly wrong. In addition to this it's actually present in the database like 20 times (with the same formula each time). Owait, apparently you can omit the hydrogens. I hate it when chemists be doing that.

## Multiple molecule crystals
Many crystals contain a few different molecules in their structure, and obvious example being water in all the transition metal salts. There are lots of these in the database like [this monstrosity](https://www.crystallography.net/cod/1554640.html) which looks like this:
![[Pasted image 20230717074405.png]]
I think it should be possible to detect this using the SMILES string but it looks like there's a convention for this in the atomic formula field of the CIF file, a ",", like so:
```
C42 H36 N4 O2 Pt2, C H2 Cl2
```
and so we should be able to detect and reject most of these on that basis.
Not always, though. [here](https://www.crystallography.net/cod/2022019.html) is an example where that is not the case. Apparently the smiles string for this is `O[C]=O.O`, although I have no idea what that means.
[Here](https://chemicbook.com/2021/02/13/smiles-strings-explained-for-beginners-part-1.html) is a good webpage on smiles strings, and it says that "." indicates disconnected structures which does indeed correctly identify the previous crystal as having two bits.
```python
    single_molecule_subset = {k: v for k, v in small_subset.items() if '.' not in v['smiles']}
```
Suggests that around 25% of the crystals have more than one molecule in them. 
## Hydrogen
It seems that in a SMILES string hydrogens are optional. The string `n1nccnc1N` represents this guy:
![[Pasted image 20230717082014.png]]
For example, which is also `C3 H4 N4`. I guess since it still has all the information then that's fine and any neural net will just learn about explicit hydrogens. The xyz position for this particular example contains 11 entries to the hydrogens are present in the output.

## Bond distances
![[Pasted image 20230720085302.png]]