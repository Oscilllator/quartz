<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Following the revelation previously that the reason that the circuit was sensitive to screwdrivers was the unshielded inductor we need to switch to some unshielded inductors."><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.21c11f9736945cd00046f30e27146846.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.e093c64fb2889253334c34b5590b69f7.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20220701%20Inductance%20measurements.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#those-were-the-wrong-graphs>Those were the wrong graphs.</a><ol><li><a href=#attach-a-magnet-to-the-big-inductor>Attach a magnet to the big inductor:</a></li></ol></li><li><a href=#actually-everything-is-fine>Actually everything is fine.</a></li><li><a href=#we-have-a-lock-again>We have a lock (again)!</a></li><li><a href=#loop-filter-gain-again>Loop filter gain (again)</a></li><li><a href=#proper-things-dont-work>Proper things don&rsquo;t work.</a><ol><li><a href=#side-note-harmonics>Side note: harmonics??</a></li></ol></li><li><a href=#loop-filters-again2>Loop filters (again^2)</a></li><li><a href=#gain-reduction>Gain reduction</a></li><li><a href=#a-lockbarely>A lock(barely):</a></li></ol></nav></details></aside><p>Following the revelation previously that the reason that the circuit was sensitive to screwdrivers was the unshielded inductor we need to switch to some unshielded inductors. I have purchased some but they don&rsquo;t work. Time to find out why with the nanoVNA.</p><a href=#inductance-measurement-principle><h1 id=inductance-measurement-principle><span class=hanchor arialabel=Anchor># </span>Inductance measurement principle.</h1></a><p><img src="/quartz/Pasted image 20220701084450.png" width=auto></p><p>Who knows how smith charts work? Not me, but let&rsquo;s proceed anyway.
It&rsquo;s known that real world inductors turn into capacitors at some point which is the point where the inductor crosses the &lsquo;x&rsquo; axis on the smith chart. It&rsquo;ss probably highly nonideal before it gets there, though.</p><p>Big wirewound OG unshielded inductor:</p><p><img src="/quartz/Pasted image 20220701182813.png" width=auto></p><p>NRH2410T100N (Big SMD):</p><p><img src="/quartz/Pasted image 20220701183149.png" width=auto></p><p>SWPA3012100MT (Small SMD):</p><p><img src="/quartz/Pasted image 20220701183415.png" width=auto></p><p>AIML-0603-100K-T (0603 SMD):</p><p><img src="/quartz/Pasted image 20220701212232.png" width=auto></p><a href=#those-were-the-wrong-graphs><h2 id=those-were-the-wrong-graphs><span class=hanchor arialabel=Anchor># </span>Those were the wrong graphs.</h2></a><p>^80ed77</p><p>According to
<a href=https://robs-blog.net/2020/06/02/using-nanovna-to-measure-inductor-q/ rel=noopener>here</a> I should have been using the R+JX graph to measure the inductor Q, since inductor Q is defined as X / R.</p><p>Here again is the AIML-0603-100K-T:</p><p><img src="/quartz/Pasted image 20220701214014.png" width=auto></p><p>At 10MHz it is 19+j743R. => 39Q
The big inductor at that 10MHz is 36.9+j758R =>21Q. There&rsquo;s clearly a much higher spiky bit for the big inductor. I&rsquo;m not sure why a</p><a href=#attach-a-magnet-to-the-big-inductor><h3 id=attach-a-magnet-to-the-big-inductor><span class=hanchor arialabel=Anchor># </span>Attach a magnet to the big inductor:</h3></a><p><img src="/quartz/Pasted image 20220702120227.png" width=auto></p><p>As mentioned before <a href=/quartz/20220617-XOR#wherersquos-that-field rel=noopener class=internal-link data-src=/quartz/20220617-XOR>20220617 XOR</a> This changes the frequency of the VCO from 10 to 14 MHz.
The parameters of the magnetised inductor are:</p><p><img src="/quartz/Pasted image 20220702120438.png" width=auto></p><a href=#actually-everything-is-fine><h2 id=actually-everything-is-fine><span class=hanchor arialabel=Anchor># </span>Actually everything is fine.</h2></a><p>It turns out that the AIML-0603-100K-T and the NRH2410T100N actually work fine - the circuit oscillates with both. with about 600mV on the varactor diode they ocsillate at 10 and 12 MHz respectively. That&rsquo;s a bit high, it would be nice if they oscillated starting with a decent amount of control voltage on the varactor diode.
The second copy of the circuit does not oscillate though. Once again we have a mismatch&mldr;
Time to go through and find the differences&mldr; &mldr;I ended up needing to change the bottom feedback capactor C4 to 100pF and the emitter resistor R16 to 330R.</p><p>After all that though the circuit is only slightly less susceptible to perturbations with a screwdriver. The PLL won&rsquo;t actually lose its lock.</p><a href=#we-have-a-lock-again><h2 id=we-have-a-lock-again><span class=hanchor arialabel=Anchor># </span>We have a lock (again)!</h2></a><p>This time you can play music through it. Beethoven comes through crystal clear, although there is a bunch of EMI if the music is played from a PC rather than an isolated source like a phone.
The maximum modulation depth on the input that can be tolerated is about 180mV:</p><p><img src="/quartz/Pasted image 20220702182942.png" width=auto></p><p>But any more than that and it starts to lose its lock:</p><p><img src="/quartz/Pasted image 20220702183023.png" width=auto></p><p>Not quite sure what the cause of that is. This is a fairly narrow range though.</p><p>Taking a zoomed in look at the PLL with the maximum amplitude lockable sine wave:</p><p><img src="/quartz/Pasted image 20220702193823.png" width=auto></p><p>We can see that there is a great deal of phase shift between the two outputs. I think that means that we need a lot more (10x?) open loop gain in the loop filter so a smaller error is needed to get our control voltage. Back to the Bode plots! ^3f8215</p><a href=#loop-filter-gain-again><h2 id=loop-filter-gain-again><span class=hanchor arialabel=Anchor># </span>Loop filter gain (again)</h2></a><p>Currently the loop filter is sitting at a rather comfortable 30dB of gain as before:</p><p><img src="/quartz/Pasted image 20220702195632.png" width=auto></p><p>I would have thought that this would be plenty to get a lock over quite a wide range of voltages - perhaps there is something more going on here, like the lowpassed phase signal being unreasonably small.</p><p>Disconnecting the feedback from the PLL the phase looks like this in open loop mode with a small difference in frequencies:</p><p><img src="/quartz/Pasted image 20220702201556.png" width=auto></p><p>Where green is the lowpassed input to the diff amp and blue is the output. It looks like the gain is quite low for the positive sections of the green waveform, but quite high for the negative sections.
The DC level of the diff amp can be adjusted with a potentiometer in place of R35.
Interestingly if you adjust it low enough there is a bit of &ldquo;reflection&rdquo; at the bottom of the waveform where the gain goes positive again:</p><p><img src="/quartz/Pasted image 20220702202528.png" width=auto></p><p>Probably best to avoid that&mldr;</p><p>Remembering that this is a <em>differential</em> amplifier, the correct thing to do for adjusting the DC input level is not to adjust where the negative rail is, but to adjust the voltage of the base of the other transistor (Q5):</p><p><img src="/quartz/Pasted image 20220703095414.png" width=auto></p><p>Putting a potentiometer between VCC and -5V is the obvious way to do this. From LT spice only a <em>very</em> small DC offset creates a very large effect thoough.</p><p><img src="/quartz/Pasted image 20220703113926.png" width=auto></p><p>Vunderbar! Adjusting the base of Q5 to be ~250mV (half of CH4) results in this lovely symmetric square wave. no wonder the PLL had trouble locking before&mldr;</p><a href=#proper-things-dont-work><h2 id=proper-things-dont-work><span class=hanchor arialabel=Anchor># </span>Proper things don&rsquo;t work.</h2></a><p>&mldr;.And now the PLL won&rsquo;t lock. It exhibits that &ldquo;popping&rdquo; behavious described before where you can adjust the frequency of the input signal to match that of the VCO and then the VCO jumps to the other side of the input signal :(</p><p><img src="/quartz/Pasted image 20220703114444.png" width=auto></p><p>Looks like there&rsquo;s some coupling between CH2 and the phase signal. Probing the output of the colpitts oscillator (before the buffer) look like this:</p><p><img src="/quartz/Pasted image 20220703114755.png" width=auto></p><p>So there is some definite coupling. Not great. Perhaps this is just the frequency dependent amplitude of the VCO though.
Remembering from before that the phase signal seemed to switch from positive to negative gain at some point I switched from the negative output of the diff amp back to the positive. This did not help.
It is once again possible to get things to lock with the loop open though. ^39d225</p><p>Let&rsquo;s go back to when things worked and take more detailed measurements:</p><p><img src="/quartz/Pasted image 20220703181158.png" width=auto></p><p>The above measurements were taken with the loop switch open.
Switching back to the diff-amp-works-great-but-pll-doesn&rsquo;t-lock state things look about the same for the various DC levels.
Since the difference in voltage between the two bases seems to be critical here I put R35 back to a fixed 8k resistor and put a voltage divider pot on Q5 base to adjust the base voltage there. If the parameters [Input frequency, negative supply voltage, Q5 base voltage] are all precisely aligned then the loop locks no problem. Any deviation from that and it won&rsquo;t.
Here is the input vs output of the diff amp with the above working configuration but in open loop:</p><p><img src="/quartz/Pasted image 20220704104242.png" width=auto></p><p>At this point the above parameters are [10.5MHz, -6V, -300mV].
Investigating each parameter in more detail: ^4bc1e2</p><ul><li>Q5Base:<ul><li>highly negative voltage like -3V is not a problem.</li><li>From the locked state 170mV will unlock. The top part of this waveform has way higher gain as you would expect.</li><li>From the unlocked state -41mV will lock (there is hysteresis). -41mV looks more or less like the triangle wave above. <a href=/quartz/20220701-Inductance-measurements#fccd30 rel=noopener class=internal-link data-src=/quartz/20220701-Inductance-measurements>20220701 Inductance measurements</a></li><li>When adjusting Q5Base across the range of good voltages there is no phase shift between the two waves prior to unlocking, it is an abrupt transition.
The Q5Base observation shows that the feedback loop just straight up doesn&rsquo;t like a high gain feedback loop. In both the working and nonworking states the feedback is negative, it&rsquo;s just that when Q5base voltage is adjusted to the average phase voltage to get proper gain on the positive and negative phase swing things just refuse to lock.
I always though that when it came to feedback loops more open loop gain was always a good thing. This seems to be contradicting that.</li></ul></li></ul><a href=#side-note-harmonics><h3 id=side-note-harmonics><span class=hanchor arialabel=Anchor># </span>Side note: harmonics??</h3></a><p>With exceedingly careful knob twiddling I got this to occur:</p><p><img src="/quartz/Pasted image 20220704112053.png" width=auto></p><p>This shows the locking to one of several(8?) different phases. To me this is indicative of the feedback occuring at a higher frequency harmonic. If things locked at an 8x harmonic then the fundamental would appear at 8 different phases like this. The waves in this circuit are deliberately large amplitude and highly distorted so I suppose this is possible, although it&rsquo;s also what loop filters and whatnot are supposed to prevent.</p><a href=#loop-filters-again2><h2 id=loop-filters-again2><span class=hanchor arialabel=Anchor># </span>Loop filters (again^2)</h2></a><p>I think that I need a pot on both R35 and Q5base is needed. Fiddling around with the pots, voltages and frequencies for a while I was not able to gradient descent to a proper solution. So I took a look through the literature again and was reminded that everyone is like &ldquo;yeah nah yeah nah a plain ol RC is all you need&rdquo;. (Note: plain ol RC does not invert signal of course). So I took the lowpasssed output of the phase detector and put it straight back onto the varactor diode, bypasing the diff amp section entirely.
The phase detector output is
<a rel=noopener class="internal-link broken" data-src="<a href=" /quartz#%5e4bc1e2" rel=noopener class=internal-link data-src=/quartz></a>">only 500mV in amplitude</a> and so I had to adjust the input frequency to something that required a varactor diode voltage of &lt;500mV but after doing that things locked fine and pretty robustly (could put in a 300mVpp modulation signal before losing the lock).
Note however that this time the PLL locks on the rising edge of the VCO:</p><p><img src="/quartz/Pasted image 20220705171004.png" width=auto></p><p>Yellow: Incoming signal, Magenta: VCO. It was different
<a rel=noopener class="internal-link broken" data-src="<a href=" /quartz#%5e3f8215" rel=noopener class=internal-link data-src=/quartz></a>">here</a>.
So in order to lock to the full vcc range I think either:</p><ul><li>Going back to the noninverting output of the diff amp to apply some hopefully non-phaseshifted gain to the passive filter</li><li>Or bearing in mind the XOR phase detector should theoretically be able to go all the way from 0->VCC just redesigning the passive filter to have less of a voltage drop.
The latter seems more efficient as the reason that I put in the diff amp in the first place was back when the mixer phase detector was being used.
Option 2 filter looks like this:</li></ul><p><img src="/quartz/Pasted image 20220704195402.png" width=auto></p><p>&mldr;But I can&rsquo;t seem to get the PLL to lock at that frequency. Same
<a rel=noopener class="internal-link broken" data-src="<a href=" /quartz#%5e39d225" rel=noopener class=internal-link data-src=/quartz></a>">popping</a> behaviour as before.
Time to take a bode diagram of this filter to compare it to the [other one.](<a href=/quartz/20220322-Look-at-that-Bode#34b78a rel=noopener class=internal-link data-src=/quartz/20220322-Look-at-that-Bode>20220322 - Look at that Bode</a>)
New RC filter:</p><p><img src="/quartz/Pasted image 20220704200052.png" width=auto></p><p>Old filter measured again with realistic load on the output of the filter (75R):</p><p><img src="/quartz/Pasted image 20220704200750.png" width=auto></p><p>Well the LC filter is certainly more dramatic but I don&rsquo;t exactly see why it works and the other doesn&rsquo;t.
<del>From the above observation about being able to lock on the rising or falling edge of the VCO, I gather that I have achieved a lock on both the rising and falling edges of the XOR phase response. So presumably what is left over is to divine what&rsquo;s wrong with the above loop filter. I think that the response time of the VCO itself is probably about [60Khz](<a href=/quartz/20220428-FM-v2-bringup#eed27d rel=noopener class=internal-link data-src=/quartz/20220428-FM-v2-bringup>20220428 FM v2 bringup</a>).
At that frequency both of the filters aren&rsquo;t doing much, altough the plain RC one has a 30deg phase shift. Maybe that&rsquo;s it?
Also it&rsquo;s not in the bode diagram for some reason but the p2p amplitude of the RC filter is a fair bit higher (1-4Vish) than the LC one (180-420mVish).</del>
I also discovered that a lock can be achieved if the RC filter <em>and</em> LC filter is connected, with the output of the RC filter going to the varactor diode and the LC filter just acting as a load. So presumably either a phase shift or an amplitude shift needs to be induced, and this is a starting point to find out which.</p><p>Here is the output of the phase detector when unlocked and with both the RC and LC filters attached. Green is raw XOR output and Blue is filter output.</p><p><img src="/quartz/Pasted image 20220705183330.png" width=auto></p><p>Here just the RC output:</p><p><img src="/quartz/Pasted image 20220705183614.png" width=auto></p><p>Next step is to load down the RC filter until it has the same amplitude as the LC version.
Here is the output of the RC filter with 70R loading it down (exactly the same resistance as the loading on the output of the LC filter incidentally).</p><p><img src="/quartz/Pasted image 20220705185933.png" width=auto></p><p>(Note the vertical scale for CH3 in this picture).</p><p>This filter results in a PLL that can track 410mV worth of frequency swing which is
<a rel=noopener class="internal-link broken" data-src="<a href=" /quartz#%5e3f8215" rel=noopener class=internal-link data-src=/quartz></a>">more than before</a>.</p><p><img src="/quartz/Pasted image 20220705190604.png" width=auto></p><p>The intention of this experiment wass to plain ol divide down the voltage, not change the impedance as actually happened. This could be done with a high input impedance buffer followed by a voltage divider. I don&rsquo;t have such a thing on hand though so that particular experiment shall be put on the shelf for later. Instead we can add a bunch of gain to this waveform and see if the PLL can still lock with it.
Here we are:</p><p><img src="/quartz/Pasted image 20220705204732.png" width=auto></p><p>Lots of gain but apparently a fair bit of phase shift, too.
I think the next step will be to reduce the gain to something like 2x and see if that still works. ^744b71</p><a href=#gain-reduction><h2 id=gain-reduction><span class=hanchor arialabel=Anchor># </span>Gain reduction</h2></a><p><img src="/quartz/Pasted image 20220708185534.png" width=auto></p><p>Changing R33 and R34 modifies the gain to about 2x:</p><p><img src="/quartz/Pasted image 20220708185622.png" width=auto></p><p>However the PLL does not seem to lock in this configuration either. It doesn&rsquo;t seem to have much bandwidth:</p><p><img src="/quartz/Pasted image 20220708185816.png" width=auto></p><p>And when the bandwidth drops off the output tends to the DC output level which is of course at the wrong voltage.
LT spice seems to think the amp should have a bandwidth of like 1MHz and previous experience agrees so I&rsquo;m not sure what&rsquo;s going on.</p><a href=#a-lockbarely><h2 id=a-lockbarely><span class=hanchor arialabel=Anchor># </span>A lock(barely):</h2></a><p>I did get the PLL to lock with the diff amp (barely). Adjusting the DC output, the lock frequency, or the Q5base voltage by even the merest of whiffs loses the lock and then a great deal of fiddling is required to get it back. You can&rsquo;t just throw the lock/unlock switch back and forth and have it lock repeatedly.
Here is the amplifier performance:</p><p><img src="/quartz/Pasted image 20220709112644.png" width=auto></p><p>Utter trash. No wonder it locks over such a narrow range.
Recalling that the original purpose of this was to find out whether having even a perfect amplifier was a bad thing I think switching to an op amp amplifier just to eliminate variables would be a good thing.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20220701 Inductance measurements.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/20220701-Inductance-measurements/ data-ctx="20220701 Inductance measurements#^fccd30" data-src=/20220701-Inductance-measurements class=internal-link></a></li><li><a href=/quartz/20220710-Reference-loop-filter/ data-ctx="20220701 Inductance measurements#^744b71" data-src=/20220710-Reference-loop-filter class=internal-link></a></li><li><a href=/quartz/20220825-microwave-tesla-coil/ data-ctx="20220701 Inductance measurements" data-src=/20220825-microwave-tesla-coil class=internal-link></a></li><li><a href=/quartz/20221025-antenna-tuning/ data-ctx="Previous resistor" data-src=/20221025-antenna-tuning class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2022</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>