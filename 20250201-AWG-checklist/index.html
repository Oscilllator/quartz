<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="The awg is sort of vaguely functional in that it produces waves. But, there are a bunch of things left to do."><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.cf4bce597ed1deaca322331d43bf8ecf.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.04378f905788159464b958eaaa8cc31d.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20250201%20AWG%20checklist.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#output-impedance>Output impedance</a><ol><li><a href=#large-signal-swings>Large signal swings</a></li><li><a href=#negative-supply-rail>Negative supply rail</a></li><li><a href=#load-on-the-dac-itself>Load on the DAC itself</a></li><li><a href=#some-experiments>Some experiments</a></li></ol></li></ol></nav></details></aside><p>The awg is sort of vaguely functional in that it produces waves. But, there are a bunch of things left to do. Checklist time!</p><ul><li>Get output impedance of awg to be very low.</li><li>Measure linearity with the scope with and without load</li><li>Fix current limiting behavior such that the AWG can&rsquo;t blow itself up.</li><li>Send out PCB for split rail power supplies.</li><li>Add barrel jack for external power since USB isn&rsquo;t going to be close to enough.</li><li>Add USB C?</li><li>input protection for the triggers and digital outputs</li><li>Add library support for the two digital outputs alongside the DAC</li><li>switchable 0R/50R/1k?R termination what for not popping devices under test.</li></ul><a href=#output-impedance><h2 id=output-impedance><span class=hanchor arialabel=Anchor># </span>Output impedance</h2></a><p>This seems the first order of business. Once this is done hopefully getting the output swing to +/-10V rather than +/-8V is a small gain change. I noticed that the output amplitude dropped quite a lot in response to a 50R load.</p><p>&mldr;Well it appears I just forgot that my 50R terminator was actually a 20dB attenuator. Here is what the (small signal) swing looks like with and without 50 ohm termination:</p><p><img src="/quartz/Pasted image 20250201124052.png" width=auto></p><p>There&rsquo;s a bit of an amplitude drop there, but is it really so bad?</p><a href=#large-signal-swings><h3 id=large-signal-swings><span class=hanchor arialabel=Anchor># </span>Large signal swings</h3></a><p>Now let&rsquo;s look at what happens to the signal when the max output swing is applied:</p><p><img src="/quartz/Pasted image 20250201124731.png" width=auto></p><p>Well it doesn&rsquo;t look very nice, but terminated/unterminated is not that different.</p><a href=#negative-supply-rail><h3 id=negative-supply-rail><span class=hanchor arialabel=Anchor># </span>Negative supply rail</h3></a><p>Swinging to -8V or so is quite close to the -10V rail and the op amp is specified up to +/-15V rails. Here is a comparison of -10 to -15V:</p><p><img src="/quartz/Pasted image 20250201125133.png" width=auto></p><p>So indeed the -15V looks a bit better, but the &lsquo;hump&rsquo; is still present at the end. Also the biasing transistors for <a href=/quartz/20250103-awg-buffer-bringup#current-path rel=noopener class=internal-link data-src=/quartz/20250103-awg-buffer-bringup>Q103 and Q107</a> get to like 130C with the -15V rail, so I really need to make those bigger. Let&rsquo;s test that next since that is likely to affect the bandwidth. Let&rsquo;s try doubling them to 680R and see what happens.</p><ul><li>REFA: Baseline, 330R bias resistor</li><li>REFB: 680R resistor. This &ldquo;only&rdquo; gets to 90C when I crank the negative supply to -15V</li><li>REFC: on a whim I detached the feedback diodes I attached earlier. More evidence they are important!</li><li>CH3 blue: 1.2k bias resistors with a +/-15V supply
<img src="/quartz/Pasted image 20250201131305.png" width=auto></li></ul><p>It looks like the 1.2k bias with the +/-15V supply is the winner. I was hoping to get away with a bit less of a supply, since this increases the dissipation in the transistors when there&rsquo;s an actual load but oh well.
<strong>Wait no actually those were 2k resistors that were in the 1.2k slot of my resistor book somehow!</strong>
Anyway this seems to have done a good job on Q103/Q107, they now sit at a gentle 60C or so which I think is more than acceptable. The actual op amp on the other hand is at a rather more toasty 90C. I wonder if we can reduce that by increasing the value of the resistor directly on the output of the op amp R114:</p><p><img src="/quartz/Pasted image 20250201132629.png" width=auto></p><p>The reason I took it down to 1R <a href=/quartz/20241207-Waveform-generator-booster-stage#an47-by-jim-williams rel=noopener class=internal-link data-src=/quartz/20241207-Waveform-generator-booster-stage>before</a> was because it dramatically decreased the bandwidth of the overall circuit. So let&rsquo;s increase it back up to 100R like the app note originally suggested, and see how that works out:</p><p><img src="/quartz/Pasted image 20250201143454.png" width=auto></p><p>This seems to have only a slightly lower bandwidth, and indeed the temperature of the op amp dropped to about 60 degrees. But the curious thing is that the output amplitude for the 50R terminated output dropped a lot (pictured) whereas the unloaded output is the same amplitude, +/-7.5V. I don&rsquo;t know why that would be. Theoretically the actual output of the whole amplifier is still going back to the noninverting input of the op amp, so that should be the error that&rsquo;s amplified.</p><p>I initially thought that perhaps the op amp was hitting the rail somehow, perhaps because of some nonlinear shenanigans involving the diodes connected between R114 and the output. But, that isn&rsquo;t the case. Wiggling the power supply rails does not change the output much. And this is the actual direct output of of the op amp probed:</p><p><img src="/quartz/Pasted image 20250201144353.png" width=auto></p><p>So that&rsquo;s not the case. This also gives the good and unsurprising piece of information that the wigglyness in the rising and falling edges of the output is due to the booster stage and not the op amp.</p><p>&mldr;
It transpires that I had indeed soldered the feedback resistor such that the op amp did not include the booster stage in its feedback path. This explains rather well the drop in output amplitude when loaded, and also rather calls into question much of todays measurements. So it goes.</p><p>Getting back on track, this is what the output now looks like unterminated (ref) and 50R terminated (CH3 blue):</p><p><img src="/quartz/Pasted image 20250201145914.png" width=auto></p><p>They now indeed are the same amplitude, which is nice, but also the rise/fall is now pretty cooked.</p><p>Here is the inverting and noninverting inputs to the op amp, the output of the op amp, and the output of the booster stage together:</p><p><img src="/quartz/Pasted image 20250201151229.png" width=auto></p><p>The noninverting input basically is what is coming out from the DAC to the op amp. I don&rsquo;t really know why the inverting input pulses low and high on the edges of the DAC signal. It looks like some kind of AC coupling type behavior. I don&rsquo;t know much about dynamic nonidealities of op amps.</p><a href=#load-on-the-dac-itself><h3 id=load-on-the-dac-itself><span class=hanchor arialabel=Anchor># </span>Load on the DAC itself</h3></a><p>Here is a measurement made across the two input resistors of the op amp:</p><p><img src="/quartz/Pasted image 20250201152757.png" width=auto></p><p><img src="/quartz/Pasted image 20250201152855.png" width=auto></p><p>Recall in this paragraph I got the noninverting and inverting inputs the wrong way round on the schematic, as is tradition:</p><p>You can see here that on the rising edge of the signal, the noninverting input looks pretty normal. The DAC side of the resistor (4) above has a slightly faster rise time than the op amp side (3). But on the inverting input things are different. There is pretty big undershoot on the inverting input.</p><p>I also at this point changed R114 which seemed to make things better. Now the op amp straight up hits the rail and it&rsquo;s obvious that the current going through R114 is what&rsquo;s charging up a bunch of capacitance in the booster circuit. There is some kind of compensation I think that needs to happen here, so that the charging can happen faster.</p><a href=#some-experiments><h3 id=some-experiments><span class=hanchor arialabel=Anchor># </span>Some experiments</h3></a><a href=#speedup-across-bias-resistor><h4 id=speedup-across-bias-resistor><span class=hanchor arialabel=Anchor># </span>&ldquo;Speedup&rdquo; across bias resistor</h4></a><p><img src="/quartz/Pasted image 20250201154138.png" width=auto></p><p><img src="/quartz/Pasted image 20250201154203.png" width=auto></p><p>The very suspicious ramp at the end of the rising edge looks like a capacitor being charged up. I also noticed that touching R101 moved around the location of this ramp, so I added a capacitor to see what would happen. It made it exactly worse, which is good info.</p><a href=#feed-forward-across-op-amp-output-resistor><h4 id=feed-forward-across-op-amp-output-resistor><span class=hanchor arialabel=Anchor># </span>Feed forward across op amp output resistor</h4></a><p><img src="/quartz/Pasted image 20250201155226.png" width=auto></p><p><img src="/quartz/Pasted image 20250201155152.png" width=auto></p><p>I added 3.3nF since 100pF like before didn&rsquo;t seem to do anything. I also decreased the frequency of the square wave I&rsquo;m sending to the AWG. You can see that indeed there is a feedforward behavior. But the frequency of the overshoot is way too low to make up for the ramp at the beginning. And the ramp itself is still very clearly present. If 100pF was way too low, and 3.3nF is way to low frequency (but good enough amplitude) then I am barking up the wrong tree here I think.</p><a href=#speedup-cap-across-first-stage-transistor><h4 id=speedup-cap-across-first-stage-transistor><span class=hanchor arialabel=Anchor># </span>Speedup cap across first stage transistor</h4></a><p><img src="/quartz/Pasted image 20250201160041.png" width=auto></p><p><img src="/quartz/Pasted image 20250201160103.png" width=auto></p><p>Boom. Now we are talking. Looks like that did the job pretty well. What&rsquo;s surprising to me though is that the falling edge of the signal is also strongly affected. How can that be?</p><a href=#two-speedup-caps><h4 id=two-speedup-caps><span class=hanchor arialabel=Anchor># </span>Two speedup caps</h4></a><p><img src="/quartz/Pasted image 20250201160703.png" width=auto></p><p><img src="/quartz/Pasted image 20250201160722.png" width=auto></p><p>?!?!? Why is it so asymmetric? Here it is zoomed out in time by a factor of 10 (ch3 only):</p><p><img src="/quartz/Pasted image 20250201160818.png" width=auto></p><a href=#further-confusion-100pf-speedup-cap><h4 id=further-confusion-100pf-speedup-cap><span class=hanchor arialabel=Anchor># </span>Further confusion: 100pF speedup cap</h4></a><p>This is the <a href=/quartz/20250201-AWG-checklist#speedup-cap-across-first-stage-transistor rel=noopener class=internal-link data-src=/quartz/20250201-AWG-checklist>above</a> redone with a 100pF cap:</p><p><img src="/quartz/Pasted image 20250201161351.png" width=auto></p><p>Now it seems again that it&rsquo;s worse. My confusion has further increased.</p><a href=#pnp-transistor-replacement><h4 id=pnp-transistor-replacement><span class=hanchor arialabel=Anchor># </span>PNP transistor replacement.</h4></a><p>I then swapped Q107 from a 2SAR512R to a DMMT5401. I did this because the 2SAR512R has this capacitance:</p><p><img src="/quartz/Pasted image 20250201171337.png" width=auto></p><p>Here &ldquo;Cob&rdquo; is
<a href="https://toshiba.semicon-storage.com/info/application_note_en_20210810_AKX00089.pdf?did=69465" rel=noopener>apparently</a> the capacitance between the collector and the base. That doc does not define what Cib is. There are so many ways to refer to this it&rsquo;s incredibly confusing. Why don&rsquo;t they just say what two terminals the capacitance is measured between? &ldquo;input capacitance&rdquo;? Input when your transistor is configured as what kind of amplifier precisely??</p><p>Anyway this is what the DMMT5401 has to say on capacitance:
<img src="/quartz/Pasted image 20250201171701.png" width=auto></p><p>What is Cobo? Is it different from Cob? One presumes not, but how do you know. Anyway the 2SAR512R clearly overall has higher capacitance, so you would think that swapping it out for the lower capacitance DMMT5401 would have a speeding-up effect. This is what it looks like:</p><p><img src="/quartz/Pasted image 20250201172218.png" width=auto></p><p>Indeed, this is faster! That&rsquo;s nice but I doubt that I am going to get a transistor with a 10x lower capacitance even than that, so something else must be possible. I think I&rsquo;ll just go with 1k of bias resistance via two 2k 0603 resistors to dissipate the power.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20250201 AWG checklist.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/20250201-AWG-checklist/ data-ctx=above data-src=/20250201-AWG-checklist class=internal-link></a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2025</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>