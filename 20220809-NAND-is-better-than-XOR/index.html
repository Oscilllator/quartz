<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="It isn&rsquo;t but it does require many fewer transistors. Two, to be precise. The only difference between a NAND gate as a phase detector and an XOR gate is this:"><title>Harry dB notes</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://Oscilllator.github.io/quartz//icon.png><link href=https://Oscilllator.github.io/quartz/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://Oscilllator.github.io/quartz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://Oscilllator.github.io/quartz/js/darkmode.9b46d81b9b161bfac149d66dfa6b3812.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://Oscilllator.github.io/quartz/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://Oscilllator.github.io/quartz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://Oscilllator.github.io/quartz/",fetchData=Promise.all([fetch("https://Oscilllator.github.io/quartz/indices/linkIndex.2b44337d7ffb2d39bd0a597d9e15c1af.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://Oscilllator.github.io/quartz/indices/contentIndex.1b07ba50b9aaf5bd2eba2512a6f843f9.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://Oscilllator.github.io/quartz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://Oscilllator.github.io/quartz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/Oscilllator.github.io\/quartz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://Oscilllator.github.io/quartz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://Oscilllator.github.io/quartz/>Harry dB notes</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><p class=meta>Last updated
Unknown
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/20220809%20NAND%20is%20better%20than%20XOR.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#current-source>Current source</a></li><li><a href=#preliminary-problems>Preliminary problems</a><ol><li><a href=#aside-probing>Aside: probing</a></li></ol></li><li><a href=#phase-output-offset>Phase output offset</a></li><li><a href=#diode-on-the-output>Diode on the output</a></li></ol><ol><li><a href=#problem-1>Problem 1</a></li><li><a href=#attempt-1-biasing>Attempt #1: biasing</a></li><li><a href=#back-to-the-phase-detector>Back to the phase detector</a></li></ol></nav></details></aside><p>It isn&rsquo;t but it does require many fewer transistors. Two, to be precise.
The only difference between a NAND gate as a phase detector and an XOR gate is this:</p><p><img src="/quartz/Pasted image 20220811205524.png" width=auto></p><p>Which actually works just fine for me, since I was having lots of trouble making an amplifier where the input goes down to the negative rail.
The whole thing put together in the simulation looks like this:</p><p><img src="/quartz/Pasted image 20220811210028.png" width=auto></p><p>(Commit hash: eac9e150ca7f149b245ef8dea28d842c9a3f5f63)</p><p>The two input transistors are responsible for providing a bunch of gain to make the output a nice big square wave. That goes into the NAND phase detector, which then goes into a diff amp.
The saturated output of the first gain stage looks like this:</p><p><img src="/quartz/Pasted image 20220811210222.png" width=auto></p><p>The second one isn&rsquo;t very high amplitude cause it&rsquo;s going straight into the base of the bottom transistor.
The NAND output looks like this:</p><p><img src="/quartz/Pasted image 20220811210323.png" width=auto></p><p>Before/after filtering.
And then with gain it looks like this (I reduced the frequency difference by 10x here):</p><p><img src="/quartz/Pasted image 20220811210426.png" width=auto></p><p>I made the gain of the diff amp about the same as last time (just under 10x) but I think it might need more this time because the phase detector output is lower amplitude by quite a bit. We&rsquo;ll see.</p><a href=#current-source><h2 id=current-source><span class=hanchor arialabel=Anchor># </span>Current source</h2></a><p>The art of electronics comes to the rescue as usual with a &ldquo;current mirror&rdquo; as a great programmable current source:</p><p><img src="/quartz/Pasted image 20220812193510.png" width=auto></p><p>Remembering that according to the ebers-moll model of a transistor the collector current of a bjt is programmed according to the base-emitter voltage of the transistor. R30 sets the collector current of U10 (and thus also it&rsquo;s base voltage) and then the base voltage of U10 is connected to U9&rsquo;s base, thus also programming it&rsquo;s collector current, the currentwe actually care about.
This seems to work pretty well:</p><p><img src="/quartz/Pasted image 20220812193744.png" width=auto></p><p>I think this has gotten good enough that it&rsquo;s time to build it!</p><a href=#preliminary-problems><h2 id=preliminary-problems><span class=hanchor arialabel=Anchor># </span>Preliminary problems</h2></a><p><img src="/quartz/Pasted image 20220813152122.png" width=auto></p><p>The output of the buffer (REF1) has too low of a duty cycle. I attribute this to the output of the buffer having too <em>high</em> of a duty cycle, and that being because it&rsquo;s hitting the rail.
So I should reduce the biasing on the base of that transistor. Because this transistor is intended to operate rail to rail (high gain) I think we have fallen into the trap of having a circuit that depends on a particular value of transistor gain. Maybe biasing <em>all</em> the amplifiers with current mirrors would work well, like this:</p><p><img src="/quartz/Pasted image 20220813203010.png" width=auto></p><p>Since we already have a current mirror we can amortise the cost of this transitor across all the places we need a bias!</p><a href=#aside-probing><h3 id=aside-probing><span class=hanchor arialabel=Anchor># </span>Aside: probing</h3></a><p>Probing the collector of U1 above is a bit tricky by default for a 10MHz signal. Even 10pF of capacitance changes the output quite a bit, and a cable can have 100pF+! So putting a 50kr resistor out from the collector of the transistor and 50R terminating at the scope gets rid of the vast majoraity of the capacitance. The signal amplitude isn&rsquo;t too bad either since it was originally 5vpp.</p><a href=#phase-output-offset><h2 id=phase-output-offset><span class=hanchor arialabel=Anchor># </span>Phase output offset</h2></a><p>It seems that the phase output doesn&rsquo;t match the simulation, the output is too close to ground. It&rsquo;s 0->XXXV rather than vcc/2->vcc. This means that things clip after the buffer because of the $V_{be}$ drop.</p><p><img src="/quartz/Pasted image 20220814133846.png" width=auto></p><p><img src="/quartz/Pasted image 20220814133647.png" width=auto></p><p>I don&rsquo;t know why exactly. Decreasing R19 here to 100R improves the offset but it looks like the phase clips at the top and bottom of the range now:</p><p><img src="/quartz/Pasted image 20220814133622.png" width=auto></p><p>Green: &lsquo;ph_buf&rsquo; node (after U6 buffer)
Pink: &lsquo;ph&rsquo; node.
So the goal here would be to reduce the quiescent current of U6.
We can do this by:</p><ul><li>Increasing R27 ( changes loop filter rolloff)</li><li>Putting new resistor from U6base to ground (also degrades signal)</li><li>Increasing the bias on U1/U2 so that they have lower output current into the NAND gate. The whole biasing scheme of these tranistors seem bad but I applied the heat gun and nothing much happened.</li></ul><p>Instead of doing the above I changed component values to the following (Notice how I got rid of the buffer):</p><p><img src="/quartz/Pasted image 20220814150154.png" width=auto></p><p>This leads to the following output:</p><p><img src="/quartz/Pasted image 20220814150215.png" width=auto></p><p>Which is great! The minimum output voltage from the diff amp is about 1.2V but that was always the plan. Just put a diode or two on the output and voila!</p><a href=#diode-on-the-output><h2 id=diode-on-the-output><span class=hanchor arialabel=Anchor># </span>Diode on the output</h2></a><p>About 3 diode drops are needed in order to get an output that goes to the negative rail. But if you do that there&rsquo;s a bunch of capacitance and whatnot and the bandwidth is garbage (I think). So instead just doing an emitter follower with some exta npn&rsquo;s in the way is the way to go:</p><p><img src="/quartz/Pasted image 20220814171526.png" width=auto></p><p>Which produces this waveform:</p><p><img src="/quartz/Pasted image 20220814171641.png" width=auto></p><p>Where green is the vout_p node and blue is the vout node.
I think this means that it&rsquo;s ready for prime time in a loop!
(A crude measurement indicates it has a 150kHz 3dB bandwidth. This actually seems to be limited by something upstream. Gee, that wouldn&rsquo;t be R27/C5 would it?)</p><a href=#prime-time><h1 id=prime-time><span class=hanchor arialabel=Anchor># </span>Prime time</h1></a><a href=#problem-1><h2 id=problem-1><span class=hanchor arialabel=Anchor># </span>Problem 1</h2></a><p>I noticed that closing the loop switch caused one of the oscillators to stop oscillating. The control output was at the positive rail (3Vish cause of diode drop) when this happened. I adjusted the pots connected to the varactor diodes for each oscillator to ~2V/11.1MHz. This caused the DC level of the phase detector to shift a lot!</p><p><img src="/quartz/Pasted image 20220814175321.png" width=auto></p><p>I think this is happening because there is an amplitude-frequency dependence to the VCO and this translates to a frequency-duty cycle dependence on the input to the NAND gate. Since the phase is the lowpassed version of the output of the NAND gate, the duty cycle of the input is very important.
Perhaps this means that my gung ho &ldquo;36k to the rail&rdquo; transistor biasing was just as terrible as I&rsquo;d feared. It should be possible to get it to the point where there is a 50% duty cycle output even with changes in the amplitude of the input.</p><a href=#attempt-1-biasing><h2 id=attempt-1-biasing><span class=hanchor arialabel=Anchor># </span>Attempt #1: biasing</h2></a><p>Here is how the art of electronics says you should bias a common emitter amplifier with a second transistor:</p><p><img src="/quartz/Pasted image 20220814180210.png" width=auto></p><p>This looks like the regular current mirror that was used on the diff amp:</p><p><img src="/quartz/Pasted image 20220814180240.png" width=auto></p><p>except for the addition of the resistors. Those resistors are there because unlike before you can&rsquo;t connect the bases directly together (that would wreck the input impedance).
Works great:</p><p><img src="/quartz/Pasted image 20220815210744.png" width=auto></p><p>The above are the two buffered outputs with the 1000:1 divider. There is a 43% duty cycle that&rsquo;s basically independent of LO frequency!
I used these values to do the baising:</p><p><img src="/quartz/Pasted image 20220815210850.png" width=auto></p><p>and one BRF106 can be used to bias two amplifiers no problemo.</p><a href=#back-to-the-phase-detector><h2 id=back-to-the-phase-detector><span class=hanchor arialabel=Anchor># </span>Back to the phase detector</h2></a><p>Closing the loop on the phase detector makes things get pretty wild:</p><p><img src="/quartz/Pasted image 20220815213304.png" width=auto></p><p>I haven&rsquo;t seen that particular pattern of wackery before. Not sure what&rsquo;s going on. It&rsquo;s not the popping behavious from before I think.</p><a href=#boom-locked><h1 id=boom-locked><span class=hanchor arialabel=Anchor># </span>Boom. Locked.</h1></a><p>I noticed before that the bandwidth was only 150KHz. I also noticed that the gain was a fair bit higher than it needed to be. Increasing the 3dB bandwidth to 1MHz by changing R27/C5 to 1kR/150pF:</p><p><img src="/quartz/Pasted image 20220818200252.png" width=auto></p><p>Increasing R26 only to 1kR changed the gain to ~2. I correctly decided that R25 is not very important.</p><p><img src="/quartz/Pasted image 20220818200358.png" width=auto></p><p>Here is an image of the thing locked with a 1.4V modulation amplitude:</p><p><img src="/quartz/Pasted image 20220818200514.png" width=auto></p><p>The shape of the modulation is garbage cause of the 1000:1 divider.
Here is the input/output shape:</p><p><img src="/quartz/Pasted image 20220818200750.png" width=auto></p><p>&mldr;obviously needs a tad more lowpass on the output there but otherwise hunky dory.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/quartz// data-ctx="20220809 NAND is better than XOR.md" data-src=/ class=internal-link>Harry dB notes</a></li><li><a href=/quartz/index_base/ data-ctx="20220809 NAND is better than XOR.md" data-src=/index_base class=internal-link>Harry dB notes</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://Oscilllator.github.io/quartz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Harry dB using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2025</p><ul><li><a href=https://Oscilllator.github.io/quartz/>Home</a></li></ul></footer></div></div></body></html>